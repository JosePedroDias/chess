import m from '../../../vendor/mithril.mjs';

import { CW, STROKE_WIDTH, EXIT_MS, SHOW_KEYS } from '../constants.mjs';
import { BLACK, WHITE } from '../colors.mjs';
import { sleep } from '../../utils.mjs';

export function Bishop({ isWhite, id }, { pos }) {
    const fill = isWhite ? WHITE : BLACK;
    const stroke = isWhite ? BLACK : WHITE;

    const x = pos[0] * CW;
    const y = pos[1] * CW;

    return m('g.enter',
        {
            key: id,
            transform: `translate(${x}, ${y})`,
            style: `fill:${fill}; stroke:${stroke}; stroke-width:${STROKE_WIDTH}; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4`,
            onbeforeremove(vnode) {
                vnode.dom.classList.add('leave');
                //return sleep(EXIT_MS);
                return new Promise((resolve) => vnode.dom.addEventListener('animationend', resolve));
            }
        },
        [
            m('title', `${isWhite ? 'white' : 'black'} bishop`),
            SHOW_KEYS && m(
                'text',
                {
                    x: 0,
                    y: 0,
                    dy: CW,
                    style: `stroke:none; fill:${fill}; font-size:7px; font-weight:600`,
                },
                id,
            ),
            m('path', {
                d: `m 21.870214,6.2945727 c -0.79978,0.0402 -1.5783,0.45852 -2.02368,1.12902 -0.38542,0.54316 -0.5925,1.22892 -0.48502,1.89384 0.0744,0.48076 0.27214,0.9425203 0.55834,1.3349403 0.0846,0.1074 0.1786,0.20718 0.27996,0.29896 -2.03544,1.61136 -3.81258,3.56226 -5.1591,5.78544 -0.95626,1.60758 -1.63864,3.40704 -1.7949,5.28068 -0.1272,1.77186 0.0998,3.57656 0.71798,5.24486 0.55558,1.50342 1.45002,2.89256 2.6465,3.96528 0.173,0.1394 0.40276,0.0812 0.6045,0.074 0.92366,-0.0604 1.86228,-0.1028 2.77876,-0.131 1.07216,-0.0278 2.14512,-0.046 3.2175,-0.0258 1.46174,0.058 2.92342,0.1226 4.38522,0.1766 0.23124,-0.006 0.38098,-0.199 0.53218,-0.34698 1.1621,-1.15984 2.03968,-2.60064 2.53612,-4.1657 0.35152,-1.11562 0.54726,-2.28062 0.58634,-3.44944 0.0568,-1.70962 -0.283,-3.42976 -0.9864,-4.98904 -0.3796,-0.85538 -0.86824,-1.65812 -1.41464,-2.41656 -0.7162,-1.02986 -1.53434,-1.98962 -2.4383,-2.85908 -0.1616,-0.1394 -0.43578,-0.062 -0.51042,0.1358 -0.97128,1.77794 -1.428,3.78394 -1.67536,5.78016 -0.169,1.356 -0.25426,2.72248 -0.25392,4.08906 -1.13886,8e-4 -2.27772,0.0016 -3.41658,0.002 -0.002,-0.51228 0.01,-1.0436 0.0318,-1.54322 0.0208,-0.44616 0.052,-0.91118 0.089,-1.34402 0.1442,-1.6052 0.4005,-3.2022 0.79754,-4.76472 0.4311,-1.65918 1.0688,-3.26658 1.91172,-4.76 0.0308,-0.053 0.0714,-0.1226 0.1058,-0.1778 0.1518,-0.2486 0.30222,-0.47392 0.4754,-0.7110403 0.1438,-0.1976 0.28754,-0.3797 0.44676,-0.57138 0.1192,-0.155 0.31024,-0.29326 0.29348,-0.5109 -0.0572,-0.65998 -0.36698,-1.29762 -0.86958,-1.73308 -0.53188,-0.47928 -1.25202,-0.73352 -1.96702,-0.69114 z m -0.2844,25.2072403 c -1.31944,0.018 -2.63996,0.0448 -3.9551,0.1596 -1.17762,0.0942 -2.36524,0.1516 -3.52156,0.40968 -0.8167,0.192 -1.63088,0.55814 -2.17784,1.21492 -0.38556,0.4481 -0.59264,1.01998 -0.68742,1.59706 -0.155,0.87586 -0.134,1.76998 -0.1198,2.65552 0.018,0.1834 0.20558,0.30402 0.38196,0.27942 7.17764,0 14.35528,0 21.53292,0 0.1682,-0.01 0.29782,-0.1714 0.28256,-0.3379 0.0312,-0.85422 0.006,-1.7123 -0.0994,-2.5608 -0.1026,-0.72736 -0.43358,-1.43278 -0.9852,-1.92686 -0.66818,-0.60706 -1.55954,-0.89288 -2.4362,-1.03002 -1.07832,-0.1734 -2.16738,-0.27432 -3.2585,-0.31608 -1.64898,-0.124 -3.30316,-0.1604 -4.95644,-0.1444 z`,
                stroke: 'none',
            }),
            m('path', {
                d: `m 21.995474,6.0237327 c -0.95638,7.6e-4 -1.90448,0.50182 -2.4143,1.3162 -0.43734,0.64396 -0.6298,1.468 -0.4424,2.2314 0.115,0.4936803 0.336,0.9685003 0.66414,1.3565603 -2.00128,1.6268 -3.74926,3.58052 -5.06652,5.80188 -0.96654,1.65754 -1.6431,3.51484 -1.76794,5.43976 -0.1296,2.21428 0.28086,4.48004 1.3084,6.45494 0.55548,1.06026 1.2725,2.0527 2.18772,2.82684 0.0866,0.0732 -0.089,0.0276 -0.131,0.043 -0.85702,0.075 -1.71898,0.163 -2.55198,0.38664 -0.83326,0.23118 -1.64282,0.66744 -2.1658,1.37316 -0.41954,0.55268 -0.60388,1.24182 -0.68628,1.92086 -0.1014,0.79772 -0.0874,1.6046 -0.0688,2.4065 0.0364,0.32142 0.37056,0.5467 0.68294,0.50312 h 21.5109 c 0.31426,-0.014 0.5646,-0.32176 0.53464,-0.63134 0.0282,-0.90876 0.006,-1.82268 -0.1276,-2.72308 -0.1464,-0.81618 -0.57522,-1.5907 -1.23838,-2.09808 -0.73758,-0.57678 -1.66564,-0.83802 -2.5801,-0.9633 -0.55352,-0.085 -1.11002,-0.1512 -1.66798,-0.1992 0.22718,-0.1594 0.4044,-0.37802 0.59932,-0.57346 1.2293,-1.31378 2.1086,-2.94786 2.53968,-4.694 0.43224,-1.71082 0.54426,-3.51502 0.22594,-5.25554 -0.27862,-1.57234 -0.90482,-3.07296 -1.77112,-4.4111 -0.72482,-1.11014 -1.53544,-2.1674 -2.45932,-3.1201 -0.192,-0.192 -0.37472,-0.39604 -0.58432,-0.5687 -0.29546,-0.197 -0.74156,-0.0526 -0.86988,0.27714 -0.96108,1.76886 -1.4273,3.75838 -1.67968,5.74222 -0.1688,1.31548 -0.2577,2.64094 -0.2696,3.96708 -0.96124,6.8e-4 -1.9225,0.0012 -2.88374,0.0018 0.002,-0.42704 0.014,-0.84492 0.031,-1.26614 0.01,-0.1854 0.0206,-0.40246 0.0338,-0.59976 0.0342,-0.54136 0.0806,-1.05146 0.1432,-1.59364 0.06,-0.51896 0.136,-1.05886 0.22398,-1.58274 0.2207,-1.30082 0.51974,-2.62312 0.9677,-3.88396 0.0734,-0.20924 0.1514,-0.42134 0.2277,-0.61622 0.0714,-0.184 0.1412,-0.35518 0.22028,-0.5425 0.32456,-0.7565 0.68364,-1.50088 1.11368,-2.2035 0.30664,-0.49416 0.665,-0.9545403 1.04428,-1.3940803 0.1342,-0.1652 0.1728,-0.38696 0.1294,-0.59244 -0.1,-0.7607 -0.51436,-1.47438 -1.13332,-1.92966 -0.52078,-0.39586 -1.17454,-0.61312 -1.8288,-0.60654 z`,
                fill: `none`,
            }),
            m('path', {
                d: `m 16.072094,31.499673 c -0.1066,0 2.59574,-0.22448 6.10066,-0.21302 3.11918,0.01 6.10068,0.1936 6.10068,0.1936`,
                fill: `none`,
            }),
        ]
    );
}
